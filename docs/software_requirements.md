# 软件需求说明书

## 1. 功能需求

1. 图片上传/拍摄：支持移动端图片选择或拍照上传。
2. 手写文本识别：调用通义千问API，提取图片中的手写文本，支持自定义Prompt模板，支持异常处理和无手写文本时的兜底提示。
3. 文本编辑：用户可对识别结果进行编辑。
4. 标签管理：支持为文本打标签，标签可增删。
   - 支持用户手动添加标签
   - 支持删除任意标签（AI生成或用户添加）
     - 每个标签显示删除图标按钮（× 图标）
     - 点击删除图标弹出确认对话框
     - 确认删除后标签立即移除，显示成功提示
   - 区分AI生成标签和用户添加标签的视觉呈现
     - AI标签：绿色边框 + 🤖 图标
     - 用户标签：蓝色边框
5. 异常处理：如未识别到文本，需友好提示。
6. 智能标签生成：在成功识别手写文本后，调用通义千问API，根据笔记内容自动生成3个高质量标签。
   - 支持自定义Prompt模板，动态插入识别文本内容。
   - 标签需反映笔记用途，避免来源类标签，简洁明了，便于检索。
   - AI生成的标签支持用户后续编辑修改或删除。
   - 若API调用失败或返回不规范，返回空标签或兜底提示，前端允许用户手动添加。
7. flomo同步：将文本、标签、图片原图同步到flomo笔记。
   - 标签格式为#标签名，标签之间用空格分隔，拼接在文本内容后。
   - 图片URL数组，最多支持9个图片。
   - 支持Webhook API（服务端POST）和URL Scheme（前端调起APP）。
   - API调用失败需返回错误信息，前端提示用户重试。

## 2. 非功能需求

- 移动端自适应，良好用户体验
- 响应速度快，识别与同步延迟低
- 安全性：图片与数据传输加密
- 易扩展，便于后续功能拓展

## 3. 接口需求

### 3.1 前后端接口
- POST /api/upload_image  上传图片，返回识别文本
  - 参数：图片文件、可选Prompt模板名
  - 返回：识别文本、状态码、错误信息（如有）
- POST /api/generate_tags  生成标签
  - 参数：识别文本内容、可选Prompt模板名
  - 返回：标签列表、状态码、错误信息（如有）
- POST /api/publish_note  发布笔记到flomo

### 3.2 第三方API
- 通义千问多模态API：图片识别接口
- flomo API：笔记同步接口

## 4. 其他说明

- 标签格式：#标签名
- 支持多标签
- 支持图片原图同步

## 5. 手写文本识别模块设计

- 配置与初始化：API Key、Base URL等配置管理，支持环境变量和配置文件。
- Prompt管理：支持多种Prompt模板，前端可指定或后端动态切换。
- 图片处理：支持本地文件和URL输入，校验图片格式。
- API调用：封装通义千问API调用，支持异常处理、超时、重试。
- 结果解析：提取手写文本，未识别到文本时返回友好提示。
- 日志与监控：记录请求、响应、异常，便于排查和优化。

## 6. 主流程串联说明

1. 用户上传图片，后端识别手写文本。
2. 若识别成功，自动调用标签生成模块，返回文本+标签。
3. 若识别失败，后端返回错误，前端提示用户重新上传。
4. 前端展示文本和标签，支持编辑。
5. 用户确认后，调用flomo API同步笔记。

## 7. 前端UI/UX与交互需求

- 使用React+Antd Mobile实现，界面现代、优雅，适配移动端。
- 支持图片上传/拍照，上传后可预览。
- 识别中、发布中有loading动画，防止误操作。
- 识别成功后，展示可编辑的文本区和标签区。
- 标签交互设计：
  - 标签以#标签名样式展示，采用自定义卡片设计，支持增删。
  - AI生成标签和用户添加标签有视觉区分：
    - AI标签：浅绿色背景、绿色边框、🤖 图标前缀
    - 用户标签：浅蓝色背景、蓝色边框
  - 标签尺寸：较大的可点击区域（高度32px+），便于移动端操作。
  - 每个标签右侧显示删除图标（× 圆圈图标）。
  - 点击删除图标触发确认对话框，防止误删。
  - 确认删除后标签立即移除，显示"标签已删除"成功提示。
  - 新增标签通过输入框+添加按钮，回车键快捷添加。
  - 自动校验重复标签和空标签，防止无效添加。
- 识别失败时，明显提示并引导重新上传。
- 发布按钮，发布成功/失败有toast提示。
- 响应式布局，适配移动端和桌面端。
- 交互细节：按钮禁用、错误提示、loading动画、平滑过渡动画等。

## 8. 前后端联调说明

- 前端通过Axios等方式请求后端API。
- 后端需支持CORS，允许前端跨域访问。
- 主要接口：
  - POST /api/upload_image：图片上传，返回识别文本和图片URL。
  - POST /api/generate_tags：传文本，返回标签列表。
  - POST /api/publish_note：传文本、标签、图片URL，发布到flomo。
- 前端所有异步操作均有loading和错误提示。
- 支持Mock数据开发，后端完成后切换真实API。 