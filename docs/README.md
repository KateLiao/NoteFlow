# NoteFlow云部署方案文档

本文档集为NoteFlow提供完整的云部署解决方案，专门针对**中国大陆网络环境**优化。

## 📋 文档导航

### 🚀 快速开始
- **[deployment_guide.md](./deployment_guide.md)** - 方案总览和选择指南
- **[step_by_step_guide.md](./step_by_step_guide.md)** - 详细分步操作指南

### 🔒 安全配置
- **[security_guide.md](./security_guide.md)** - API密钥安全管理指南
- **[security_setup_process.md](./security_setup_process.md)** - 完整安全配置流程记录

### 💰 成本与分析
- **[cost_analysis.md](./cost_analysis.md)** - 各方案成本详细对比分析

### 🛠️ 技术文档

### 架构与设计
- [📋 软件需求规格说明书](software_requirements.md) - 详细的功能需求和技术规格
- [🏗️ 系统架构设计](system_architecture.md) - 技术架构和组件设计

### 部署与运维
- [🚀 快速部署指南](step_by_step_guide.md) - 从零到一的完整部署流程
- [⚙️ 部署配置手册](deployment_guide.md) - 详细的服务器配置说明
- [📊 成本分析报告](cost_analysis.md) - 云服务成本评估和优化建议

### 安全配置
- [🔒 安全配置指南](security_guide.md) - API密钥和敏感信息管理
- [🔧 安全配置流程](security_setup_process.md) - 完整的安全配置实施记录

### 开发维护
- [🐛 开发机修复记录](development_fix_record.md) - 问题追溯和修复经验积累

---

## 🎯 推荐部署方案

### 方案A：腾讯云全家桶 ⭐️⭐️⭐️⭐️⭐️
- **💵 成本**：60元/年（含域名）
- **🎯 适用**：个人使用、预算有限
- **✅ 优势**：几乎免费、配置简单、文档完善

### 方案B：阿里云组合 ⭐️⭐️⭐️⭐️
- **💵 成本**：84元/年（含域名）
- **🎯 适用**：企业级应用、流量较大
- **✅ 优势**：生态完善、服务成熟

### 方案C：华为云方案 ⭐️⭐️⭐️⭐️
- **💵 成本**：68元/年（含域名）
- **🎯 适用**：小团队、稳定性优先
- **✅ 优势**：成本适中、稳定性好

---

## 🚀 30分钟快速部署

### 前置条件
- [ ] 已注册云服务商账号（推荐腾讯云）
- [ ] 完成实名认证
- [ ] 准备通义千问API Key
- [ ] 准备flomo webhook地址

### 部署流程
```bash
# 1. 准备后端代码
cd NoteFlow/backend
pip install mangum==0.17.0
# 按照 step_by_step_guide.md 打包代码

# 2. 部署云函数
# 上传到腾讯云函数，配置环境变量

# 3. 构建前端
cd NoteFlow/frontend
npm run build

# 4. 部署前端
# 上传dist文件夹到静态网站托管

# 5. 测试验证
# 访问前端域名，测试完整流程
```

---

## 💡 关键配置要点

### 后端环境变量
```bash
DASHSCOPE_API_KEY=sk-your-api-key
FLMO_WEBHOOK_URL=https://flomoapp.com/iwh/your-webhook
```

### 前端API配置
```javascript
const API_BASE_URL = 'https://your-scf-api-gateway-url.com';
```

### 云函数配置
- **内存**：512MB
- **超时**：60秒
- **并发**：100
- **触发器**：API网关（免鉴权）

---

## 🔒 安全重要提醒

⚠️ **上传GitHub前必读**：[security_guide.md](./security_guide.md)

**快速检查清单**：
- [ ] 代码中无硬编码API密钥
- [ ] `.env` 文件已添加到 `.gitignore`
- [ ] 使用 `env.example` 模板
- [ ] 运行安全检查脚本

**设置环境变量**：
```bash
# 自动设置（推荐）
./setup.sh    # Linux/Mac
setup.bat     # Windows

# 手动设置
cp env.example .env
# 编辑 .env 填入真实密钥
```

---

## 📊 成本预估

| 使用场景 | 腾讯云方案A | 华为云方案C | 阿里云方案B |
|---------|------------|-------------|-------------|
| **个人轻度使用** | 0-5元/月 | 1-6元/月 | 2-8元/月 |
| **个人中度使用** | 5-20元/月 | 6-25元/月 | 8-30元/月 |
| **团队重度使用** | 20-50元/月 | 25-70元/月 | 30-80元/月 |

> 💡 所有方案都包含充足的免费额度，个人使用基本不会产生额外费用

---

## 🛡️ 安全注意事项

### 必须配置
- [x] HTTPS强制访问
- [x] API密钥环境变量化
- [x] CORS正确配置
- [x] 文件大小限制

### 推荐配置
- [ ] 自定义域名
- [ ] SSL证书
- [ ] 访问日志
- [ ] 使用量监控

---

## 🔧 故障排除

### 常见问题
1. **图片上传失败**
   - 检查文件大小（<6MB）
   - 确认CORS配置正确

2. **API调用超时**
   - 增加云函数超时时间
   - 检查网络连接

3. **前端无法访问后端**
   - 确认API网关地址正确
   - 检查CORS设置

4. **环境变量错误**
   - 参考 [security_guide.md](./security_guide.md)
   - 检查 `.env` 文件配置

### 调试方法
```bash
# 查看云函数日志
# 腾讯云控制台 → 云函数 → 日志查询

# 测试API连通性
curl https://your-api-gateway-url.com/

# 检查环境变量
python -c "import os; print('API Key设置:', bool(os.getenv('DASHSCOPE_API_KEY')))"
```

---

## 📈 性能优化建议

### 前端优化
- 启用CDN加速
- 配置资源缓存
- 压缩图片资源
- 使用Gzip压缩

### 后端优化
- 合理设置函数内存
- 优化冷启动时间
- 添加响应缓存
- 监控调用频率

---

## 🔄 版本更新流程

### 代码更新
1. 修改本地代码
2. 重新打包部署
3. 测试验证功能
4. 更新版本标签

### 配置更新
1. 修改环境变量
2. 重启云函数
3. 验证配置生效
4. 更新文档说明

---

## 📞 技术支持

### 云服务商支持
- **腾讯云**：400-8018-830
- **阿里云**：95187
- **华为云**：400-8008-955

### 社区资源
- 腾讯云开发者社区
- 阿里云开发者社区
- Stack Overflow
- GitHub Issues

---

## 📅 部署时间规划

### 快速部署（1天）
- 只部署功能，使用默认域名
- 适合快速验证和测试

### 标准部署（3天）
- 包含自定义域名和SSL
- 完整的监控和日志配置

### 企业部署（1周）
- 包含备案流程
- 完整的安全和性能优化

---

## 🎉 部署完成后

### 验证清单
- [ ] 前端页面正常访问
- [ ] 图片上传功能正常
- [ ] 文本识别功能正常
- [ ] 标签生成功能正常
- [ ] flomo发布功能正常
- [ ] 移动端适配良好

### 后续维护
- 定期检查用量和费用
- 关注云服务商的功能更新
- 备份重要配置和数据
- 监控系统运行状态

---

**开始部署：请先阅读 [security_guide.md](./security_guide.md) 确保安全配置！** 